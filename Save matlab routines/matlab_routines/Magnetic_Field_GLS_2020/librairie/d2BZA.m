function d2BZA = d2BZA(l,a,b,z)%% function d2BZA = d2BZA(l,a,b,z)%% Returns the SECOND derivative of the on-axis magnetic field % associated to a rectangular coil centered on z=0% in which a unit current density 1/(a*b) [A/m^2] is flowing% The analytic formula is exact on the axis and is based on% Martin Wilson: 'Superconducting Magnets', Oxford Science publications, 1990, p20.% plus some cumbersome derivation.% %%	Version:	1.0		J.-P. Hogge		Sept 25, 2001%%   a	: Minor radius%	b	: major radius%   l   : longitudinal extent of the coil (from -l/2 to +l/2)%   z	: a one-dimensional array	mu0 = 4*pi*1e-7;		T1	= T(l,a,b,-z);	T2	= T(l,a,b,z);	T3	= T(l,a,a,-z);	T4  = T(l,a,a,z);		T5  = (T1-b/a).^2;	T6  = (T2-b/a).^2;	T7  = (T3-1).^2;	T8  = (T4-1).^2;					d2BZA = mu0/16/a^4 * ( ...					 (l^3 +12*l*z.^2)   .* (  -1./(T1.*T5.^1.5)   -1./(T1.^2.*T5)     -1./(T2.*T6.^1.5)   -1./(T2.^2.*T6)      ...					                          +1./(T3.*T7.^1.5)   +1./(T3.^2.*T7)     +1./(T4.*T8.^1.5)   +1./(T4.^2.*T8) )    ...					  +  (8*z.^3 + 6*l^2*z) .* (  +1./(T1.*T5.^1.5)   +1./(T1.^2.*T5)     -1./(T2.*T6.^1.5)   -1./(T2.^2.*T6)      ...					                          -1./(T3.*T7.^1.5)   -1./(T3.^2.*T7)     +1./(T4.*T8.^1.5)   +1./(T4.^2.*T8) )    ...					  +   24*z*a^2          .* (  -1./(T1.*sqrt(T5))  +1./(T2.*sqrt(T6))  +1./(T3.*sqrt(T7))  -1./(T4.*sqrt(T8)))  ...				  +   12*l*a^2           * (  +1./(T1.*sqrt(T5))  +1./(T2.*sqrt(T6))  -1./(T3.*sqrt(T7))  -1./(T4.*sqrt(T8)))  ...					);			%	d2BZA = mu0/16/a^4 * ( ...%					  l^3  * (  -1./(T1.*T5.^1.5) -1./(T1.^2.*T5) -1./(T2.*T6.^1.5) -1./(T2.^2.*T6)      ...%					            +1./(T3.*T7.^1.5) +1./(T3.^2.*T7) +1./(T4.*T8.^1.5) +1./(T4.^2.*T8) )    ...	%				  + 6*l^2  * (  +1./(T1.*T5.^1.5) +1./(T1.^2.*T5) -1./(T2.*T6.^1.5) -1./(T2.^2.*T6)      ...%					            -1./(T3.*T7.^1.5) -1./(T3.^2.*T7) +1./(T4.*T8.^1.5) +1./(T4.^2.*T8) ).*z ...	%				  + 8*z   .* ( a^2   * ( -3./(T1.*sqrt(T5)) +3./(T2.*sqrt(T6)) +3./(T3.*sqrt(T7)) -3./(T4.*sqrt(T8)) )      ...%				              +z.^2 .* ( +1./(T1.*T5.^1.5)  +1./(T1.^2.*T5)    -1./(T2.*T6.^1.5)  -1./(T2.^2.*T6)           ...%					                     -1./(T3.*T7.^1.5)  -1./(T3.^2.*T7)    +1./(T4.*T8.^1.5)  +1./(T4.^2.*T8)  )   )    ...%				  + 12*l   * ( a^2   * ( +1./(T1.*sqrt(T5)) +1./(T2.*sqrt(T6)) -1./(T3.*sqrt(T7)) -1./(T4.*sqrt(T8)) )      ...%				              +z.^2 .* ( -1./(T1.*T5.^1.5)  -1./(T1.^2.*T5)    -1./(T2.*T6.^1.5)  -1./(T2.^2.*T6)           ...%					                     +1./(T3.*T7.^1.5)  +1./(T3.^2.*T7)    +1./(T4.*T8.^1.5)  +1./(T4.^2.*T8)  )   )    ...%					);		return